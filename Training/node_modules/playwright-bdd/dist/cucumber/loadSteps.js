"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.hasTsNodeRegister = exports.loadSteps = void 0;
const api_1 = require("@cucumber/cucumber/api");
const transform_1 = require("../playwright/transform");
const cache = new Map();
async function loadSteps(runConfiguration, environment = {}) {
    const cacheKey = JSON.stringify(runConfiguration);
    let lib = cache.get(cacheKey);
    if (!lib) {
        // use Playwright's built-in hook to compile TypeScript steps
        const uninstall = !hasTsNodeRegister(runConfiguration) ? (0, transform_1.installTransform)() : () => { };
        lib = (0, api_1.loadSupport)(runConfiguration, environment).finally(() => uninstall());
        cache.set(cacheKey, lib);
    }
    return lib;
}
exports.loadSteps = loadSteps;
function hasTsNodeRegister(runConfiguration) {
    return runConfiguration.support.requireModules?.includes('ts-node/register');
}
exports.hasTsNodeRegister = hasTsNodeRegister;
//# sourceMappingURL=loadSteps.js.map